---
title: "Temperature"
author: "HM Putnam"
date: "1/3/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#Install and Load necessary libraries
if("lubridate" %in% rownames(installed.packages()) == 'FALSE') install.packages('lubridate') 
if("tidyverse" %in% rownames(installed.packages()) == 'FALSE') install.packages('tidyverse') 
if("emmeans" %in% rownames(installed.packages()) == 'FALSE') install.packages('emmeans') 
if("gridExtra" %in% rownames(installed.packages()) == 'FALSE') install.packages('gridExtra') 

library(lubridate)
library(tidyverse)
library(emmeans)
library(gridExtra)
```

## Acclimation Temperature
### Insert timeframe here

```{r }
##### CONTINUOUS TEMPERATURE DATA FROM HOBO LOGGERS #####
#Acclimation period data

##### QC Acclimation Hobo Files #####

#Timeframe

# Read in temp data 
Tank1 <- read.csv("data/Temp/20201231_Tank1_20444040.csv", sep=",", skip=c(2), header=FALSE, na.strings = "NA")[ ,2:3]
Tank2 <- read.csv("data/Temp/20201231_Tank2_20719656.csv", sep=",", skip=c(2), header=FALSE, na.strings = "NA")[ ,2:3]
Tank2 <- Tank2[1:nrow(Tank1),]
Tank3 <- read.csv("data/Temp/20201231_Tank3_20946643.csv", sep=",", skip=c(2), header=FALSE, na.strings = "NA")[ ,2:3]
Tank3 <- Tank3[1:nrow(Tank1),]
Tank4 <- read.csv("data/Temp/20201231_Tank4_2044042.csv", sep=",", skip=c(2), header=FALSE, na.strings = "NA")[ ,2:3]
Tank4 <- Tank4[1:nrow(Tank1),]
Tank5 <- read.csv("data/Temp/20201231_Tank5_20719658.csv", sep=",", skip=c(2), header=FALSE, na.strings = "NA")[ ,2:3]
Tank5 <- Tank5[1:nrow(Tank1),]
Tank6 <- read.csv("data/Temp/20201231_Tank6_20444029.csv", sep=",", skip=c(2), header=FALSE, na.strings = "NA")[ ,2:3]
Tank6 <- Tank6[1:nrow(Tank1),]
Tank7 <- read.csv("data/Temp/20201231_Tank7_20444032.csv", sep=",", skip=c(2), header=FALSE, na.strings = "NA")[ ,2:3]
Tank7 <- Tank7[1:nrow(Tank1),]
Tank8 <- read.csv("data/Temp/20201231_Tank8_20946642.csv", sep=",", skip=c(2), header=FALSE, na.strings = "NA")[ ,2:3]
Tank8 <- Tank8[1:nrow(Tank1),]
Tank9 <- read.csv("data/Temp/20201231_Tank9_20719657.csv", sep=",", skip=c(2), header=FALSE, na.strings = "NA")[ ,2:3]
Tank9 <- Tank9[1:nrow(Tank1),]
Tank10 <- read.csv("data/Temp/20201231_Tank10_20946645.csv", sep=",", skip=c(2), header=FALSE, na.strings = "NA")[ ,2:3]
Tank10 <- Tank10[1:nrow(Tank1),]
Tank11 <- read.csv("data/Temp/20201231_Tank11_20444034.csv", sep=",", skip=c(2), header=FALSE, na.strings = "NA")[ ,2:3]
Tank11 <- Tank11[1:nrow(Tank1),]
Tank12 <- read.csv("data/Temp/20201231_Tank12_20946644.csv", sep=",", skip=c(2), header=FALSE, na.strings = "NA")[ ,2:3]
Tank12 <- Tank12[1:nrow(Tank1),]
Tank14 <- read.csv("data/Temp/20201231_Tank14_20937868.csv", sep=",", skip=c(3), header=FALSE, na.strings = "NA")[ ,1:2]
Tank14 <- Tank14[1:nrow(Tank1),]
Tank15 <- read.csv("data/Temp/20201231_Tank15_20937869.csv", sep=",", skip=c(3), header=FALSE, na.strings = "NA")[ ,1:2]
Tank15 <- Tank15[1:nrow(Tank1),]
Tank16 <- read.csv("data/Temp/20201231_Tank16_20937870.csv", sep=",", skip=c(3), header=FALSE, na.strings = "NA")[ ,1:2]
Tank16 <- Tank16[1:nrow(Tank1),]
Tank17 <- read.csv("data/Temp/20201231_Tank17_20937871.csv", sep=",", skip=c(3), header=FALSE, na.strings = "NA")[ ,1:2]
Tank17 <- Tank17[1:nrow(Tank1),]

data <- cbind(Tank1, Tank2$V3, Tank3$V3, Tank4$V3, Tank5$V3, Tank6$V3,
              Tank7$V3, Tank8$V3, Tank9$V3, Tank10$V3, Tank11$V3,
              Tank12$V3, Tank14$V2, Tank15$V2, Tank16$V2, Tank17$V2)
colnames(data) <- c("Date.Time", "Tank1","Tank2", "Tank3", "Tank4", "Tank5", "Tank6",
                    "Tank7","Tank8", "Tank9", "Tank10", "Tank11", "Tank12",
                    "Tank14", "Tank15", "Tank16", "Tank17")
data$Date.Time <- parse_date_time(data$Date.Time, "%m/%d/%y %I:%M:%S %p", tz = "EST")
data$Date.Time <- data$Date.Time + hours(5) # add 3 hours
data <- data[13:nrow(data)-6,]
#Save acclimation data to file
temp.acc.data <- data
write.csv(temp.acc.data,file="output/Acclimation.Temperature_data.csv")

#Convert to Long
temp.acc.data <- pivot_longer(temp.acc.data, cols = Tank1:Tank17, names_to="Tank" )

Acc.Temps <- ggplot(temp.acc.data, aes(x=Date.Time, y=value)) +
  geom_line(aes(color = Tank), size = 1)+
  #ylim(5,15)+
  ylab("Temperature °C")
ggsave("output/AcclimationTemps.pdf", plot = last_plot(), width = 8, height = 4)

```

```{r }
# Read in tide data 
tides <- read.csv("data/tide.csv", sep=",", header=TRUE, na.strings = "NA")
tides$Date.Time <- paste(tides$Date, tides$Time.LST, sep = " ")
tides$Date.Time <- parse_date_time(tides$Date.Time, "%m/%d/%y %H:%M", tz = "EST")
tides$Prelim.m <- as.numeric(as.character(tides$Prelim.m))
tides <- tides[191:2531,]

tides.fig <- ggplot(tides, aes(x=Date.Time, y=Prelim.m)) +
  geom_line()+
  ylim(0,2)+
  ylab("Tidal Height m")
ggsave("output/Tidalcycle.pdf", plot = last_plot(), width = 8, height = 4)


temperatureColor <- "red"
priceColor <- "black"

ggplot() +
geom_line(data=data, aes(x=Date.Time, y=Tank1), color='red') + 
geom_line(data=tides, aes(x=Date.Time, y=Prelim.m), color='black')+
  scale_y_continuous(
    # Features of the first axis
    name = "Temperature (°C)",
    # Add a second axis and specify its features
    sec.axis = sec_axis(~., name="Tidal Height (m)")) + 
  theme(
    axis.title.y = element_text(color = temperatureColor, size=13),
    axis.title.y.right = element_text(color = priceColor, size=13)
  )
ggsave("output/Tank_Temps_Tides.pdf", plot = last_plot(), width = 8, height = 4)

```
